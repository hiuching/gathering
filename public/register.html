<!DOCTYPE html>
<style>
#main {
	width: 100%;
	height:100%;
}
#container {
	margin-left: 45%;
	margin-top: 15%;
}
#titleImg {
	font-size: 24px;
	font-weight: bold;
}
#msg {
	color: red;
}

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20150503/json2.min.js"></script>
<script src="https://raw.github.com/andris9/jStorage/master/jstorage.js"></script>
<script> /* $.jStorage is now available */ </script>
<script>
	$(document).ready (function() {
		var parameters = location.search.substring(1);
		if (parameters == "forget")
			$('#titleImg').text("Forget Password");
		else if (parameters == "joinUs")
			$('#titleImg').text("Sign Up");
		
	
		$('#submit').click (function(){
			if (($('#email').val()) == ""){
				$('#msg').text ("Please fill in your email address");
				return;
				}
			var data = {
				email: $('#email').val(),
			}
			$.support.cors = true;
			data = JSON.stringify (data);
			$.ajax({
				type: 'POST',
				contentType: 'application/json',
				url: 'http://ec2-52-68-199-65.ap-northeast-1.compute.amazonaws.com:8081/gathering/user',
				data: data,
				dataType: 'json',
				success: function (user) {
					var str = 'email:' + user.email;
					console.log ('success', str);
					if (parameters == "forget")
						$('#msg').html("Your password is reset successful, Please check your mail box to get a new password.<br/> The browser will redirect to login page after 3 seconds...");
					else if (parameters == "joinUs")
						$('#msg').html("Registration is successful. Please check your mail box to get a password.</br> The browser will redirect to login page after 3 seconds...");
					setTimeout(function() {window.location.href = 'index.html';}, 3000);

				},
				error: function (err){
					console.log ('failed', err);
					$('#msg').text ("Wrong email address");
					return;
				}
			});
			//
		});
	});
</script>
<html>
	<head>
		<title>Gathering</title>
	</head>
	<body>
		<div id = "main">
			<div id = "container">
				<span id = "titleImg"></span><br/><br/>
				&nbsp; &nbsp; Email: <input type = "text" id = "email"/><br/><br/>
				<p id = "msg"></p><br/><br/>
				<button id = "submit" style="margin-left: 10%">Submit</button>
			</div>
		</div>
	</body>
</html>